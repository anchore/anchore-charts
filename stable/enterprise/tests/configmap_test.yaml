suite: ConfigMap Tests
templates:
  - templates/envvars_configmap.yaml
  - templates/policybundle_configmap.yaml
  - templates/scripts_configmap.yaml
  - templates/ui_configmap.yaml
  - templates/configmaps/datasyncer_configmap.yaml
  - templates/configmaps/api_configmap.yaml
  - templates/configmaps/catalog_configmap.yaml
  - templates/configmaps/notifications_configmap.yaml
  - templates/configmaps/policyengine_configmap.yaml
  - templates/configmaps/reports_configmap.yaml
  - templates/configmaps/reportsworker_configmap.yaml
  - templates/configmaps/simplequeue_configmap.yaml
  - templates/configmaps/anchore_common_configmap.yaml
  - templates/configmaps/analyzer_configmap.yaml

values:
  - values.yaml
release:
  name: test-release
  namespace: test-namespace
chart:
  version: 9.9.9
  appVersion: 9.9.9
tests:
  - it: should render the configmaps
    asserts:
      - matchSnapshot: {}

  - it: should render a custom config when configOverride is set
    templates:
      - templates/configmaps/api_configmap.yaml
      - templates/configmaps/catalog_configmap.yaml
      - templates/configmaps/datasyncer_configmap.yaml
      - templates/configmaps/notifications_configmap.yaml
      - templates/configmaps/policyengine_configmap.yaml
      - templates/configmaps/reports_configmap.yaml
      - templates/configmaps/reportsworker_configmap.yaml
      - templates/configmaps/simplequeue_configmap.yaml
    set:
      configOverride: |
        service_dir: /foobar
        tmp_dir: /test

        log_level: DEBUG
    asserts:
      - matchRegex:
          path: data["config.yaml"]
          pattern: |
            #
            service_dir: /foobar
            tmp_dir: /test

            log_level: DEBUG
