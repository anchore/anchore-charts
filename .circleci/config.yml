version: 2.1

jobs:
  lint-charts:
    docker:
      - image: circleci/python:3.6
    steps:
      - checkout
      - run:
          name: Lint Charts
          command: |
            helm repo add stable https://kubernetes-charts.storage.googleapis.com
            make lint-chart-engine

  install-charts:
    docker:
      - image: circleci/python:3.6
    resource_class: large
    steps:
      - checkout
      - run:
          command: |
            helm repo add stable https://kubernetes-charts.storage.googleapis.com
            make install-chart-engine
            make smoke-tests
            make cluster-down

workflows:
  version: 2.1
  lint-and-install:
    jobs:
      - lint-charts
      - install-charts:
          requires:
            - lint-charts
